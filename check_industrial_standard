#!/bin/bash
echo "=== INDUSTRIE-QUALITÄTS-CHECK: START ==="

# 1. Formatierung (Stabiler Standard)
echo "[1/5] Prüfe Formatierung..."
cargo fmt -- --check || { echo "Fehler: Formatierung entspricht nicht dem Standard!"; exit 1; }

# 2. Statische Analyse (Pedantisch)
echo "[2/5] Starte Clippy (Pedantic Mode)..."
cargo clippy -- -D clippy::pedantic || { echo "Fehler: Code-Qualität unzureichend!"; exit 1; }

# 3. Sicherheits-Audit (CVEs)
echo "[3/5] Scanne nach Sicherheitslücken (RustSec)..."
cargo audit || { echo "Warnung: Bekannte Sicherheitslücken gefunden!"; }

# 4. Memory Safety Check
echo "[4/5] Scanne nach 'unsafe' Code-Blöcken..."
cargo geiger --forbid-unsafe || { echo "Warnung: Unsafe Code gefunden!"; }

# 5. Lizenz-Check
echo "[5/5] Prüfe Lizenz-Compliance (MIT/Apache)..."
cargo deny check licenses || { echo "Fehler: Unerlaubte Lizenzen gefunden!"; exit 1; }

echo "=== ALLE CHECKS BESTANDEN: BEREIT FÜR DEN REALLIFE-EINSATZ ==="

# 6. generate do
cargo doc --no-deps --open
